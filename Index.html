<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poker Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#111111" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#0b0b0b; color:#f2f2f2;}
    header { padding: 16px; border-bottom: 1px solid #222; position: sticky; top:0; background:#0b0b0b; z-index: 5;}
    h1 { margin:0; font-size: 18px;}
    main { padding: 16px; max-width: 1100px; margin: 0 auto;}
    .grid { display: grid; gap: 12px; grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .grid3 { display: grid; gap: 12px; grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .grid4 { display: grid; gap: 12px; grid-template-columns: repeat(4, minmax(0, 1fr)); }
    .card { background:#121212; border:1px solid #222; border-radius: 12px; padding: 14px;}
    label { display:block; font-size: 12px; color:#bdbdbd; margin-bottom: 6px;}
    input, select, textarea { width:100%; padding:10px; border-radius:10px; border:1px solid #2a2a2a; background:#0f0f0f; color:#f2f2f2; }
    textarea { min-height: 70px; resize: vertical;}
    button { padding: 10px 12px; border-radius: 10px; border:1px solid #2a2a2a; background:#1b1b1b; color:#fff; cursor:pointer;}
    button.primary { background:#2b6cff; border-color:#2b6cff;}
    button.danger { background:#2b2b2b; border-color:#3a1d1d; color:#ffb3b3;}
    .row { display:flex; gap:10px; flex-wrap: wrap; align-items: center;}
    .row > * { flex: 1 1 auto; }
    .muted { color:#bdbdbd; font-size: 12px;}
    table { width:100%; border-collapse: collapse; }
    th, td { text-align:left; padding: 10px; border-bottom: 1px solid #222; font-size: 13px; vertical-align: top;}
    th { color:#bdbdbd; font-weight:600;}
    .pos { color:#6dff9b; }
    .neg { color:#ff6d6d; }
    .pill { display:inline-block; padding: 2px 8px; border-radius:999px; border:1px solid #2a2a2a; color:#dcdcdc; font-size:12px;}
    .kpi { font-size:20px; font-weight:700; }
    @media (max-width: 820px) {
      .grid, .grid3, .grid4 { grid-template-columns: 1fr; }
      th:nth-child(4), td:nth-child(4) { display:none; } /* hide notes column on small screens */
    }
  </style>
</head>
<body>
  <header>
    <div class="row" style="gap:12px;">
      <div style="flex:2;">
        <h1>♠️ Poker Tracker</h1>
        <div class="muted">Offline • Private • On-device storage</div>
      </div>
      <div style="flex:1; min-width:180px;">
        <label style="margin-bottom:6px;">Year (Jan 1 → Dec 31)</label>
        <select id="yearSelect"></select>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <h2 style="margin:0 0 10px 0; font-size:16px;">Add Session</h2>

      <div class="grid">
        <div>
          <label>Date</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label>Type</label>
          <select id="type">
            <option value="Cash">Cash</option>
            <option value="Tournament">Tournament</option>
          </select>
        </div>
      </div>

      <div class="grid3" style="margin-top:12px;">
        <div>
          <label>Location</label>
          <input id="location" placeholder="e.g., Home game, casino, online" />
        </div>
        <div>
          <label>Stakes / Buy-in</label>
          <input id="stakes" placeholder="e.g., 1/3, $200 BI, $55 MTT" />
        </div>
        <div>
          <label>Hours Played</label>
          <input id="hours" type="number" step="0.25" min="0" placeholder="e.g., 4.5" />
        </div>
      </div>

      <div class="grid3" style="margin-top:12px;">
        <div>
          <label>Buy-in (total)</label>
          <input id="buyin" type="number" step="0.01" placeholder="e.g., 300" />
        </div>
        <div>
          <label>Cash-out / Winnings</label>
          <input id="cashout" type="number" step="0.01" placeholder="e.g., 525" />
        </div>
        <div>
          <label>Result</label>
          <input id="result" disabled />
        </div>
      </div>

      <div style="margin-top:12px;">
        <label>Notes</label>
        <textarea id="notes" placeholder="Optional: game notes, leaks, mood, etc."></textarea>
      </div>

      <div class="row" style="margin-top:12px;">
        <button class="primary" id="addBtn">Add Session</button>
        <button id="exportBtn">Export Backup</button>
        <label style="margin:0;">
          <span class="muted">Import Backup</span>
          <input id="importFile" type="file" accept="application/json" />
        </label>
      </div>
    </section>

    <section class="grid4" style="margin-top:12px;">
      <div class="card">
        <div class="muted">YTD Profit</div>
        <div id="statProfit" class="kpi">$0</div>
        <div id="statProfitMeta" class="muted">Jan 1 → today</div>
      </div>
      <div class="card">
        <div class="muted">Sessions (YTD)</div>
        <div id="statSessions" class="kpi">0</div>
        <div class="muted">Cash + Tournaments</div>
      </div>
      <div class="card">
        <div class="muted">Avg / Session</div>
        <div id="statAvg" class="kpi">$0</div>
        <div class="muted">YTD</div>
      </div>
      <div class="card">
        <div class="muted">Hourly</div>
        <div id="statHourly" class="kpi">$0/hr</div>
        <div class="muted">YTD hours based</div>
      </div>
    </section>

    <section class="grid3" style="margin-top:12px;">
      <div class="card">
        <div class="muted">Best Month</div>
        <div id="bestMonth" class="kpi">—</div>
        <div id="bestMonthMeta" class="muted">—</div>
      </div>
      <div class="card">
        <div class="muted">Best Day (Date)</div>
        <div id="bestDate" class="kpi">—</div>
        <div id="bestDateMeta" class="muted">—</div>
      </div>
      <div class="card">
        <div class="muted">Best Day of Week</div>
        <div id="bestDow" class="kpi">—</div>
        <div id="bestDowMeta" class="muted">—</div>
      </div>
    </section>

    <section class="grid" style="margin-top:12px;">
      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <h2 style="margin:0; font-size:16px;">Monthly Breakdown</h2>
            <div class="muted">Total profit per month</div>
          </div>
        </div>
        <div style="overflow:auto; margin-top:10px;">
          <table>
            <thead><tr><th>Month</th><th>Profit</th><th>Sessions</th><th>Hours</th></tr></thead>
            <tbody id="monthTbody"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <h2 style="margin:0; font-size:16px;">Day-of-Week Breakdown</h2>
            <div class="muted">Total profit by weekday</div>
          </div>
        </div>
        <div style="overflow:auto; margin-top:10px;">
          <table>
            <thead><tr><th>Day</th><th>Profit</th><th>Sessions</th><th>Hours</th></tr></thead>
            <tbody id="dowTbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px;">
      <div class="row" style="align-items:center;">
        <div style="flex:2;">
          <h2 style="margin:0; font-size:16px;">Sessions</h2>
          <div class="muted">Newest first</div>
        </div>
        <button class="danger" id="clearBtn" style="flex:0;">Clear All</button>
      </div>

      <div style="overflow:auto; margin-top:10px;">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Game</th>
              <th>Profit</th>
              <th>Notes</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
